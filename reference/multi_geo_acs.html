<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fetch an ACS table with multiple geography levels — multi_geo_acs • cwi</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fetch an ACS table with multiple geography levels — multi_geo_acs"><meta name="description" content="Fetch a data table from the ACS via tidycensus with your choice of geographies at multiple levels. For geographies made of aggregates, i.e. neighborhoods made of tracts or regions made of towns, the returned table will have estimates summed and margins of error calculated for the whole area. Any geographic levels that are null will be excluded."><meta property="og:description" content="Fetch a data table from the ACS via tidycensus with your choice of geographies at multiple levels. For geographies made of aggregates, i.e. neighborhoods made of tracts or regions made of towns, the returned table will have estimates summed and margins of error calculated for the whole area. Any geographic levels that are null will be excluded."><meta property="og:image" content="https://CT-Data-Haven.github.io/cwi/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cwi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.11.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/cwi.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/acs-updates.html">ACS updates</a></li>
    <li><a class="dropdown-item" href="../articles/regions.html">Regions</a></li>
    <li><a class="dropdown-item" href="../articles/shapefiles.html">Shapefiles</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CT-Data-Haven/cwi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fetch an ACS table with multiple geography levels</h1>
      <small class="dont-index">Source: <a href="https://github.com/CT-Data-Haven/cwi/blob/main/R/multi_geo_fetch.R" class="external-link"><code>R/multi_geo_fetch.R</code></a></small>
      <div class="d-none name"><code>multi_geo_acs.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fetch a data table from the ACS via <code>tidycensus</code> with your choice of geographies at multiple levels. For geographies made of aggregates, i.e. neighborhoods made of tracts or regions made of towns, the returned table will have estimates summed and margins of error calculated for the whole area. Any geographic levels that are null will be excluded.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">multi_geo_acs</span><span class="op">(</span></span>
<span>  <span class="va">table</span>,</span>
<span>  year <span class="op">=</span> <span class="va">endyears</span><span class="op">[[</span><span class="st">"acs"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  towns <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  regions <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  counties <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  state <span class="op">=</span> <span class="st">"09"</span>,</span>
<span>  neighborhoods <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tracts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  blockgroups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pumas <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  msa <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  us <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  new_england <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  nhood_name <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>  nhood_geoid <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nhood_weight <span class="op">=</span> <span class="st">"weight"</span>,</span>
<span>  survey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"acs5"</span>, <span class="st">"acs1"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  key <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sleep <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-table">table<a class="anchor" aria-label="anchor" href="#arg-table"></a></dt>
<dd><p>A string giving the ACS table number.</p></dd>


<dt id="arg-year">year<a class="anchor" aria-label="anchor" href="#arg-year"></a></dt>
<dd><p>The year of the ACS table; currently defaults 2023 (most recent available).</p></dd>


<dt id="arg-towns">towns<a class="anchor" aria-label="anchor" href="#arg-towns"></a></dt>
<dd><p>A character vector of names of towns to include; <code>"all"</code> (default) for all towns optionally filtered by county; or <code>NULL</code> to not fetch town-level table.</p></dd>


<dt id="arg-regions">regions<a class="anchor" aria-label="anchor" href="#arg-regions"></a></dt>
<dd><p>A named list of regions with their town names (defaults <code>NULL</code>).</p></dd>


<dt id="arg-counties">counties<a class="anchor" aria-label="anchor" href="#arg-counties"></a></dt>
<dd><p>A character vector of names of counties to include; <code>"all"</code> (default) for all counties in the state; or <code>NULL</code> to not fetch county-level table.</p></dd>


<dt id="arg-state">state<a class="anchor" aria-label="anchor" href="#arg-state"></a></dt>
<dd><p>A string: either name or two-digit FIPS code of a US state. Required; defaults <code>"09"</code> (Connecticut).</p></dd>


<dt id="arg-neighborhoods">neighborhoods<a class="anchor" aria-label="anchor" href="#arg-neighborhoods"></a></dt>
<dd><p>A data frame with columns for neighborhood name, GEOID of either tracts or block groups, and weight, e.g. share of each tract assigned to a neighborhood. If included, weighted sums and MOEs will be returned for neighborhoods. Try to match the formatting of the <a href="neighborhood_tracts.html">built-in neighborhood tables</a>.</p></dd>


<dt id="arg-tracts">tracts<a class="anchor" aria-label="anchor" href="#arg-tracts"></a></dt>
<dd><p>A character vector of 11-digit FIPS codes of tracts to include, or <code>"all"</code> for all tracts optionally filtered by county. Defaults <code>NULL</code>.</p></dd>


<dt id="arg-blockgroups">blockgroups<a class="anchor" aria-label="anchor" href="#arg-blockgroups"></a></dt>
<dd><p>A character vector of 12-digit FIPS codes of block groups to include, or <code>"all"</code> for all block groups optionally filtered by county. Defaults <code>NULL</code>.</p></dd>


<dt id="arg-pumas">pumas<a class="anchor" aria-label="anchor" href="#arg-pumas"></a></dt>
<dd><p>A character vector of 7-digit FIPS codes of public use microdata areas (PUMAs) to include, or <code>"all"</code> for all PUMAs optionally filtered by county. It's up to you to filter out any redundancies–some large towns are standalone PUMAs, as are some sparsely-population counties. Defaults <code>NULL</code>.</p></dd>


<dt id="arg-msa">msa<a class="anchor" aria-label="anchor" href="#arg-msa"></a></dt>
<dd><p>Logical: whether to fetch New England states' metropolitan statistical areas. Defaults <code>FALSE</code>.</p></dd>


<dt id="arg-us">us<a class="anchor" aria-label="anchor" href="#arg-us"></a></dt>
<dd><p>Logical: whether to fetch US-level table. Defaults <code>FALSE</code>.</p></dd>


<dt id="arg-new-england">new_england<a class="anchor" aria-label="anchor" href="#arg-new-england"></a></dt>
<dd><p>Logical: if <code>TRUE</code> (the default), limits metro areas to just New England states.</p></dd>


<dt id="arg-nhood-name">nhood_name<a class="anchor" aria-label="anchor" href="#arg-nhood-name"></a></dt>
<dd><p>String giving the name of the column in the data frame <code>neighborhoods</code> that contains neighborhood names. Previously this was a bare column name, but for consistency with changes to COG-based FIPS codes, this needs to be a string. Only relevant if a neighborhood weight table is being used. Defaults <code>"name"</code> to match the neighborhood lookup datasets.</p></dd>


<dt id="arg-nhood-geoid">nhood_geoid<a class="anchor" aria-label="anchor" href="#arg-nhood-geoid"></a></dt>
<dd><p>String giving the name of the column in <code>neighborhoods</code> that contains neighborhood GEOIDs, either tracts or block groups. Only relevant if a neighborhood weight table is being used. Because of changes to FIPS codes, this no longer has a default.</p></dd>


<dt id="arg-nhood-weight">nhood_weight<a class="anchor" aria-label="anchor" href="#arg-nhood-weight"></a></dt>
<dd><p>String giving the name of the column in <code>neighborhoods</code> that contains weights between neighborhood names and tract/block groups. Only relevant if a neighborhood weight table is being used. Defaults <code>"weight"</code> to match the neighborhood lookup datasets.</p></dd>


<dt id="arg-survey">survey<a class="anchor" aria-label="anchor" href="#arg-survey"></a></dt>
<dd><p>A string: which ACS estimate to use. Defaults to 5-year (<code>"acs5"</code>), but can also be 1-year (<code>"acs1"</code>).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical: whether to print summary of geographies included. Defaults <code>TRUE</code>.</p></dd>


<dt id="arg-key">key<a class="anchor" aria-label="anchor" href="#arg-key"></a></dt>
<dd><p>String: Census API key. If <code>NULL</code> (default), takes the value from <code>Sys.getenv("CENSUS_API_KEY")</code>.</p></dd>


<dt id="arg-sleep">sleep<a class="anchor" aria-label="anchor" href="#arg-sleep"></a></dt>
<dd><p>Number of seconds, if any, to sleep before each API call. This might help with the Census API's tendency to crash, but for many geographies, it could add a sizable about of time. Probably don't add more than a few seconds.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">tidycensus::get_acs</a></code></p><dl><dt><code>variables</code></dt>
<dd><p>Character string or vector of character strings of variable
IDs. tidycensus automatically returns the estimate and the margin of error
associated with the variable.</p></dd>

    <dt><code>output</code></dt>
<dd><p>One of "tidy" (the default) in which each row represents an
enumeration unit-variable combination, or "wide" in which each row
represents an enumeration unit and the variables are in the columns.</p></dd>

    <dt><code>county</code></dt>
<dd><p>The county for which you are requesting data. County names and
FIPS codes are accepted. Must be combined with a value supplied to `state`.
Defaults to NULL.</p></dd>

    <dt><code>zcta</code></dt>
<dd><p>The zip code tabulation area(s) for which you are requesting
data. Specify a single value or a vector of values to get data for more
than one ZCTA. Numeric or character ZCTA GEOIDs are accepted. When
specifying ZCTAs, geography must be set to `"zcta"` and `state` must be specified with
`county` left as `NULL`. Defaults to NULL.</p></dd>

    <dt><code>geometry</code></dt>
<dd><p>if FALSE (the default), return a regular tibble of ACS data.
if TRUE, uses the tigris package to return an sf tibble with simple feature
geometry in the `geometry` column.</p></dd>

    <dt><code>keep_geo_vars</code></dt>
<dd><p>if TRUE, keeps all the variables from the Census
shapefile obtained by tigris.  Defaults to FALSE.</p></dd>

    <dt><code>shift_geo</code></dt>
<dd><p>(deprecated) if TRUE, returns geometry with Alaska and Hawaii shifted for
thematic mapping of the entire US. Geometry was originally obtained from
the albersusa R package. As of May 2021, we recommend using <code><a href="https://rdrr.io/pkg/tigris/man/shift_geometry.html" class="external-link">tigris::shift_geometry()</a></code>
instead.</p></dd>

    <dt><code>summary_var</code></dt>
<dd><p>Character string of a "summary variable" from the ACS to
be included in your output. Usually a variable (e.g. total population) that
you'll want to use as a denominator or comparison.</p></dd>

    <dt><code>moe_level</code></dt>
<dd><p>The confidence level of the returned margin of error.  One
of 90 (the default), 95, or 99.</p></dd>

    <dt><code>show_call</code></dt>
<dd><p>if TRUE, display call made to Census API. This can be very
useful in debugging and determining if error messages returned are due to
tidycensus or the Census API. Copy to the API call into a browser and see
what is returned by the API directly. Defaults to FALSE.</p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tibble with GEOID, name, variable code, estimate, moe, geography level, state, and year, as applicable, for the chosen ACS table.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function essentially calls <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">tidycensus::get_acs()</a></code> multiple times, depending on geographic levels chosen, and does minor cleaning, filtering, and aggregation. Note that the underlying <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">tidycensus::get_acs()</a></code> requires a Census API key. As is the case with other <code>tidycensus</code> functions, <code>multi_geo_acs</code> assumes this key is stored as <code>CENSUS_API_KEY</code> in your <code>.Renviron</code> or other source of environment variables. See <code><a href="https://walker-data.com/tidycensus/reference/census_api_key.html" class="external-link">tidycensus::census_api_key()</a></code> for installation.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://walker-data.com/tidycensus/reference/census_api_key.html" class="external-link">tidycensus::census_api_key()</a></code>, <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">tidycensus::get_acs()</a></code></p>
<p>Other fetching-functions:
<code><a href="laus_trend.html">laus_trend</a>()</code>,
<code><a href="multi_geo_decennial.html">multi_geo_decennial</a>()</code>,
<code><a href="qwi_industry.html">qwi_industry</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu">multi_geo_acs</span><span class="op">(</span><span class="st">"B01003"</span>, <span class="fl">2018</span>,</span></span>
<span class="r-in"><span>    towns <span class="op">=</span> <span class="st">"all"</span>,</span></span>
<span class="r-in"><span>    regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>inner_ring <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hamden"</span>, <span class="st">"East Haven"</span>, <span class="st">"West Haven"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    counties <span class="op">=</span> <span class="st">"New Haven County"</span>,</span></span>
<span class="r-in"><span>    tracts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">new_haven_tracts</span><span class="op">$</span><span class="va">geoid</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">multi_geo_acs</span><span class="op">(</span><span class="st">"B01003"</span>, <span class="fl">2023</span>,</span></span>
<span class="r-in"><span>    towns <span class="op">=</span> <span class="st">"Bridgeport"</span>,</span></span>
<span class="r-in"><span>    counties <span class="op">=</span> <span class="st">"Greater Bridgeport COG"</span>,</span></span>
<span class="r-in"><span>    neighborhoods <span class="op">=</span> <span class="va">bridgeport_tracts</span>,</span></span>
<span class="r-in"><span>    nhood_name <span class="op">=</span> <span class="st">"name"</span>,</span></span>
<span class="r-in"><span>    nhood_geoid <span class="op">=</span> <span class="st">"geoid_cog"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Camille Seaberry.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

