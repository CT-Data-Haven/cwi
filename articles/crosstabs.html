<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with Community Wellbeing Survey crosstabs • cwi</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with Community Wellbeing Survey crosstabs">
<meta property="og:description" content="cwi">
<meta property="og:image" content="https://CT-Data-Haven.github.io/cwi/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cwi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/acs-updates.html">ACS updates</a>
    </li>
    <li>
      <a href="../articles/basic-workflow.html">Basic workflow</a>
    </li>
    <li>
      <a href="../articles/crosstabs.html">Working with Community Wellbeing Survey crosstabs</a>
    </li>
    <li>
      <a href="../articles/regions.html">Regions</a>
    </li>
    <li>
      <a href="../articles/shapefiles.html">Shapefiles</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CT-Data-Haven/cwi/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with Community Wellbeing Survey
crosstabs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CT-Data-Haven/cwi/blob/HEAD/vignettes/crosstabs.Rmd" class="external-link"><code>vignettes/crosstabs.Rmd</code></a></small>
      <div class="hidden name"><code>crosstabs.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CT-Data-Haven/cwi" class="external-link">cwi</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tiny theme of a few cleaned up arguments</span></span>
<span><span class="va">theme_clean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>      strip.text.y.left <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>      strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>      panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      plot.title.position <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>      plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="va">...</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This is a quick look at using the crosstab-related functions that
were expanded upon to make the <code>dcws</code> package. There are 3
test files of crosstabs that ship with this package for internal testing
and illustration. This vignette recreates the data in the
<code>cws_demo</code> dataset.</p>
<div class="figure">
<img src="../reference/figures/xtab-screenshot.png" title="Screenshot of DCWS crosstabs spreadsheet" style="width:100.0%" alt=""><p class="caption">Screenshot of DCWS crosstabs spreadsheet</p>
</div>
<div class="section level2">
<h2 id="reading-data">Reading data<a class="anchor" aria-label="anchor" href="#reading-data"></a>
</h2>
<p><code>read_xtabs</code> reads a crosstab file, but keeps it ugly—you
can then transform it into a ready-for-analysis data frame with
<code>xtab2df</code>. Below all the survey data, the file has a table of
weights. It’s hard to know where that table might be and how to separate
it from the data tables. <code>read_xtabs</code> reads until a marker
that distinguishes between the data and the weights;
<code>read_weights</code> reads everything below that marker.</p>
<p>The data for the first question looks like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xtab_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_xtabs.html">read_xtabs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/test_xtab2015.xlsx"</span>, package <span class="op">=</span> <span class="st">"cwi"</span><span class="op">)</span>, year <span class="op">=</span> <span class="fl">2015</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xtab_in</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 26</span></span></span>
<span><span class="co">#&gt;   x1     x2    x3    x4    x5    x6    x7    x8    x9    x10   x11   x12   x13  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Q1. A… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    Gend… <span style="color: #BB0000;">NA</span>    Age   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    Race… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>     Conn… Grea… M     F     18-34 35-49 50-64 65+   White Blac… Hisp… Other</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Yes    0.82  0.82  0.8   0.84  0.85  0.77  0.83  0.86  0.84  0.8   0.78  0.72 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> No     0.17  0.17  0.18  0.15  0.14  0.22  0.16  0.13  0.15  0.19  0.21  0.24 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Don't… 0.01  0.01  0.01  0.01  0.01  0.01  0.01  0.01  0.01  0.01  0.01  0.04 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Refus… 0     0     0     0     0     0     0     0     0     0     0     0    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13 more variables: x14 &lt;chr&gt;, x15 &lt;chr&gt;, x16 &lt;chr&gt;, x17 &lt;chr&gt;, x18 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   x19 &lt;chr&gt;, x20 &lt;chr&gt;, x21 &lt;chr&gt;, x22 &lt;chr&gt;, x23 &lt;chr&gt;, x24 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   x25 &lt;chr&gt;, x26 &lt;chr&gt;</span></span></span></code></pre></div>
<p>Reshape the crosstabs into something you’d actually want to work with
using <code>xtab2df</code>. That snippet from the first chunk now looks
like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cws</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xtab2df.html">xtab2df</a></span><span class="op">(</span><span class="va">xtab_in</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cws</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code</span> <span class="op">==</span> <span class="st">"Q8"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   code  question                                   category group response value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Q8    Do you have access to a car when you need… Connect… Conn… Very of…  0.85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Q8    Do you have access to a car when you need… Greater… Grea… Very of…  0.82</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Q8    Do you have access to a car when you need… Gender   M     Very of…  0.83</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Q8    Do you have access to a car when you need… Gender   F     Very of…  0.82</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Q8    Do you have access to a car when you need… Age      18-34 Very of…  0.75</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Q8    Do you have access to a car when you need… Age      35-49 Very of…  0.88</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="combining-demographic-groups">Combining demographic groups<a class="anchor" aria-label="anchor" href="#combining-demographic-groups"></a>
</h2>
<p>Say we want to collapse those income brackets into just 3 groups. For
that, use the weights table…and fix the group labels in the weights
table to match the ones from the data (I’m only doing this for income,
but education often needs reconciling as well). Obviously there won’t be
weights for the total group; in doing weighted means, the easiest fix is
to replace NAs with 1. (FYI, groups Yes and No correspond to the
category of having children in the household.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wts_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_xtabs.html">read_weights</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/test_xtab2015.xlsx"</span>, package <span class="op">=</span> <span class="st">"cwi"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">wts_in</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 23 × 2</span></span></span>
<span><span class="co">#&gt;    group                  weight</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Male                    0.47 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Female                  0.53 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 18 to 34                0.292</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 35 to 49                0.244</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 50 to 64                0.236</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 65 and older            0.173</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> White                   0.727</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> African American/Black  0.158</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Hispanic                0.109</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Other                   0.103</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13 more rows</span></span></span>
<span></span>
<span><span class="va">wts</span> <span class="op">&lt;-</span> <span class="va">wts_in</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">group</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="st">"(?&lt;=\\d) to (?=[\\$\\d])"</span>, <span class="st">"-"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="st">",000"</span>, <span class="st">"K"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="st">"Less than (?=\\$)"</span>, <span class="st">"&lt;"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="st">" or more"</span>, <span class="st">"+"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">income_lvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"&lt;$30K"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;$15K"</span>, <span class="st">"$15K-$30K"</span><span class="op">)</span>,</span>
<span>  <span class="st">"$30K-$100K"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"$30K-$50K"</span>, <span class="st">"$50K-$75K"</span>, <span class="st">"$75K-$100K"</span><span class="op">)</span>,</span>
<span>  <span class="st">"$100K+"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"$100K-$200K"</span>, <span class="st">"$200K+"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cws</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code</span> <span class="op">==</span> <span class="st">"Q8"</span>, <span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greater New Haven"</span>, <span class="st">"Income"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">wts</span>, by <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">category</span><span class="op">:</span><span class="va">response</span>, <span class="fu">forcats</span><span class="fu">::</span><span class="va"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/collapse_n_wt.html">collapse_n_wt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">category</span><span class="op">:</span><span class="va">response</span><span class="op">)</span>, .lvls <span class="op">=</span> <span class="va">income_lvls</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 28 × 5</span></span></span>
<span><span class="co">#&gt;    code  category          group             response      value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Q8    Greater New Haven Greater New Haven Very often   0.82  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Q8    Greater New Haven Greater New Haven Fairly often 0.04  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Q8    Greater New Haven Greater New Haven Sometimes    0.06  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Q8    Greater New Haven Greater New Haven Almost never 0.02  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Q8    Greater New Haven Greater New Haven Never at all 0.06  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Q8    Greater New Haven Greater New Haven Don't know   0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Q8    Greater New Haven Greater New Haven Refused      0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Q8    Income            &lt;$30K             Very often   0.597 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Q8    Income            &lt;$30K             Fairly often 0.069<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Q8    Income            &lt;$30K             Sometimes    0.124 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 18 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rescaling">Rescaling<a class="anchor" aria-label="anchor" href="#rescaling"></a>
</h2>
<p>We generally want to remove non-answers (don’t know, refused) from
the denominator, then rescale the response values. Usually those
non-answers only account for 1 or 2 percentage points and don’t change
values much, but occasionally they’re large enough to make a noticeable
difference. For consistency, I always remove non-answers, even when
they’re small.</p>
<p>With non-answers:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cws</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code</span> <span class="op">==</span> <span class="st">"Q1"</span>, <span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greater New Haven"</span>, <span class="st">"Gender"</span>, <span class="st">"Age"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 28 × 6</span></span></span>
<span><span class="co">#&gt;    code  question                                  category group response value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Q1    Are you satisfied with the city or area … Greater… Grea… Yes       0.82</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Q1    Are you satisfied with the city or area … Gender   M     Yes       0.8 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Q1    Are you satisfied with the city or area … Gender   F     Yes       0.84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Q1    Are you satisfied with the city or area … Age      18-34 Yes       0.85</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Q1    Are you satisfied with the city or area … Age      35-49 Yes       0.77</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Q1    Are you satisfied with the city or area … Age      50-64 Yes       0.83</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Q1    Are you satisfied with the city or area … Age      65+   Yes       0.86</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Q1    Are you satisfied with the city or area … Greater… Grea… No        0.17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Q1    Are you satisfied with the city or area … Gender   M     No        0.18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Q1    Are you satisfied with the city or area … Gender   F     No        0.15</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 18 more rows</span></span></span></code></pre></div>
<p>Without nonanswers (using <code>sub_nonanswers</code> defaults of
“Don’t know” &amp; “Refused”):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cws</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code</span> <span class="op">==</span> <span class="st">"Q1"</span>, <span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greater New Haven"</span>, <span class="st">"Gender"</span>, <span class="st">"Age"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/sub_nonanswers.html">sub_nonanswers</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 6</span></span></span>
<span><span class="co">#&gt;    code  question                                  category group response value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Q1    Are you satisfied with the city or area … Greater… Grea… Yes      0.828</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Q1    Are you satisfied with the city or area … Greater… Grea… No       0.172</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Q1    Are you satisfied with the city or area … Gender   M     Yes      0.808</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Q1    Are you satisfied with the city or area … Gender   M     No       0.182</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Q1    Are you satisfied with the city or area … Gender   F     Yes      0.848</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Q1    Are you satisfied with the city or area … Gender   F     No       0.152</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Q1    Are you satisfied with the city or area … Age      18-34 Yes      0.859</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Q1    Are you satisfied with the city or area … Age      18-34 No       0.141</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Q1    Are you satisfied with the city or area … Age      35-49 Yes      0.778</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Q1    Are you satisfied with the city or area … Age      35-49 No       0.222</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Q1    Are you satisfied with the city or area … Age      50-64 Yes      0.838</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Q1    Are you satisfied with the city or area … Age      50-64 No       0.162</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Q1    Are you satisfied with the city or area … Age      65+   Yes      0.869</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Q1    Are you satisfied with the city or area … Age      65+   No       0.131</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="case-study">Case study<a class="anchor" aria-label="anchor" href="#case-study"></a>
</h2>
<p>For many questions, what you probably want to report out or display
is the share of people who answered yes, or the combination of “strongly
agree” &amp; “somewhat agree”.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cws</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code</span> <span class="op">==</span> <span class="st">"Q1"</span>, <span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greater New Haven"</span>, <span class="st">"Gender"</span>, <span class="st">"Age"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/sub_nonanswers.html">sub_nonanswers</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">response</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">category</span><span class="op">:</span><span class="va">group</span>, <span class="fu">forcats</span><span class="fu">::</span><span class="va"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">)</span>,</span>
<span>    group <span class="op">=</span> <span class="va">group</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span>Men <span class="op">=</span> <span class="st">"M"</span>, Women <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relabel.html" class="external-link">fct_relabel</a></span><span class="op">(</span><span class="va">str_replace</span>, <span class="st">"(^\\b)(?=\\d+)"</span>, <span class="st">"Ages "</span><span class="op">)</span>,</span>
<span>    category <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">category</span>, Total <span class="op">=</span> <span class="st">"Greater New Haven"</span><span class="op">)</span>,</span>
<span>    lbl <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">value</span>, accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.8</span>, fill <span class="op">=</span> <span class="st">"#047e87"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">lbl</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fl">1</span>, nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">0.01</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">category</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, space <span class="op">=</span> <span class="st">"free_y"</span>, switch <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Neighborhood satisfaction is high across age and gender"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Share of adults satisfied with area, Greater New Haven, 2015"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Source: 2015 DataHaven Community Wellbeing Survey"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="crosstabs_files/figure-html/chart-1.png" width="100%"></p>
<p>Note that different questions have different response values. In
general, it’s better to work with each question separately; easy and
safe ways to do this are to make separate data frames for different
questions (e.g. with <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter</a></code>), or by splitting
(e.g. with <code>split(data$question)</code>) and iterating with
<code>lapply</code> or <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map</a></code> before binding or joining
back together.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cws</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">question</span>, <span class="va">response</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">response</span>, <span class="st">"(Don't know|Refused)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>question <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trunc.html" class="external-link">str_trunc</a></span><span class="op">(</span><span class="va">question</span>, width <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>responses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">response</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   question                                                             responses</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (If attacked in the past 12 months) Were you physically injured in … Yes, No  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> (If smoked 100 cigarettes) Do you currently smoke cigarettes every … Every da…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Are you satisfied with the city or area where you live?              Yes, No  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> As a place to live, is the city or area where you live getting much… Much bet…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Do you have access to a car when you need it? Would you say you hav… Very oft…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Have there been times in the past 12 months when you did not have e… Yes, No  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Have you smoked at least 100 cigarettes in your entire life? [100 c… Yes, No  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> How responsive local government is to the needs of residents         Excellen…</span></span></code></pre></div>
<p>A common use is to show multiple related indicators side by side in a
table or chart. Here I’m prepping to show both the question about
neighborhood satisfaction (yes / no) and the responsiveness of local
government (combined excellent &amp; good).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">govt</span> <span class="op">&lt;-</span> <span class="va">cws</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">category</span>, <span class="va">group</span><span class="op">)</span>, <span class="fu">forcats</span><span class="fu">::</span><span class="va"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Q1"</span>, <span class="st">"Q3A"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="op">~</span><span class="va">code</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cws_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cws_out</span><span class="op">[[</span><span class="st">"satisfied_with_area"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">govt</span><span class="op">$</span><span class="va">Q1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/sub_nonanswers.html">sub_nonanswers</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">response</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cws_out</span><span class="op">[[</span><span class="st">"local_govt_is_responsive"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">govt</span><span class="op">$</span><span class="va">Q3A</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>response <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_collapse.html" class="external-link">fct_collapse</a></span><span class="op">(</span>excellent_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Excellent"</span>, <span class="st">"Good"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="op">-</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/sub_nonanswers.html">sub_nonanswers</a></span><span class="op">(</span>nons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Don't know enough about it in order to say"</span>, <span class="st">"Refused"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">response</span> <span class="op">==</span> <span class="st">"excellent_good"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'code', 'question', 'category', 'group'.</span></span>
<span><span class="co">#&gt; You can override using the `.groups` argument.</span></span>
<span></span>
<span><span class="va">cws_out</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"indicator"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    group <span class="op">=</span> <span class="va">group</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relabel.html" class="external-link">fct_relabel</a></span><span class="op">(</span><span class="va">str_replace</span>, <span class="st">"(^\\b)(?=\\d+)"</span>, <span class="st">"Ages "</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span>Black <span class="op">=</span> <span class="st">"Black/Afr Amer"</span><span class="op">)</span>,</span>
<span>    category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">category</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>, <span class="st">"Total"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    lbl <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">value</span>, accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    indicator <span class="op">=</span> <span class="fu">camiller</span><span class="fu">::</span><span class="fu"><a href="https://camille-s.github.io/camiller/reference/clean_titles.html" class="external-link">clean_titles</a></span><span class="op">(</span><span class="va">indicator</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Total"</span>, <span class="st">"Age"</span>, <span class="st">"Race/Ethnicity"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.8</span>, fill <span class="op">=</span> <span class="st">"#047e87"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">lbl</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fl">1</span>, nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">0.01</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">category</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">indicator</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span>, space <span class="op">=</span> <span class="st">"free_y"</span>, switch <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Neighborhood satisfaction is high, even when government\nfeels unresponsive"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Share of adults, Greater New Haven, 2015"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Source: 2015 DataHaven Community Wellbeing Survey"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="crosstabs_files/figure-html/govt_chart-1.png" width="100%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Camille Seaberry.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
